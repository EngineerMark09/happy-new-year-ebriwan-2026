<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="A cinematic New Year 2026 experience">
    <title>2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400&family=Playfair+Display:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root {
            --black: #000000;
            --void: #050507;
            --charcoal: #0c0c0f;
            --graphite: #151518;
            --slate: #1e1e23;
            --steel: #2d2d35;
            --grey: #4a4a55;
            --silver: #7a7a88;
            --mist: #a0a0ac;
            --cloud: #c8c8d0;
            --snow: #e5e5ea;
            --white: #ffffff;
            --gold: #c9a227;
            --gold-light: #e8d48a;
            --rose: #d4a5a5;
            --blue: #a5b8d4;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            width: 100%; height: 100%;
            overflow: hidden;
            background: var(--black);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: var(--white);
            cursor: default;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        body.immersive, body.immersive * { cursor: none; }

        /* === LAYERS === */
        .layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
        }

        #sky { z-index: 1; }
        #aurora { z-index: 2; opacity: 0; }
        #stars { z-index: 3; }
        #shootingStars { z-index: 4; }
        #fireworks { z-index: 5; opacity: 0; }
        
        .ui-layer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        /* === OVERLAYS === */
        .grain {
            position: fixed;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            z-index: 1000;
            pointer-events: none;
            opacity: 0.025;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
            animation: grainMove 0.5s steps(1) infinite;
        }

        @keyframes grainMove {
            0% { transform: translate(0,0); }
            20% { transform: translate(-2%,-1%); }
            40% { transform: translate(1%,2%); }
            60% { transform: translate(-1%,-2%); }
            80% { transform: translate(2%,1%); }
        }

        .vignette {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 100;
            pointer-events: none;
            background: radial-gradient(ellipse 80% 80% at 50% 50%, transparent 30%, rgba(0,0,0,0.4) 70%, rgba(0,0,0,0.85) 100%);
        }

        .glow-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0;
            pointer-events: none;
            z-index: 0;
            transition: opacity 3s ease;
        }
        .glow-1 { width: 500px; height: 500px; top: -150px; left: -150px; background: rgba(40, 30, 60, 0.4); }
        .glow-2 { width: 600px; height: 600px; bottom: -200px; right: -200px; background: rgba(60, 40, 30, 0.3); }
        .glow-3 { width: 400px; height: 400px; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(201, 162, 39, 0.05); }

        /* === SCENES === */
        .scene {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            z-index: 50;
        }
        .scene.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* === INTRO SCENE === */
        #intro { background: transparent; }

        .intro-text {
            font-size: clamp(0.65rem, 1.2vw, 0.75rem);
            font-weight: 300;
            letter-spacing: 0.4em;
            text-transform: uppercase;
            color: var(--silver);
            margin-bottom: 3.5rem;
            opacity: 0;
            transform: translateY(10px);
        }

        .intro-btn {
            position: relative;
            width: 140px; height: 140px;
            background: none;
            border: none;
            cursor: pointer;
            opacity: 0;
            transform: scale(0.95);
        }

        .btn-outer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border: 1px solid var(--steel);
            border-radius: 50%;
            transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .btn-middle {
            position: absolute;
            top: 15%; left: 15%;
            width: 70%; height: 70%;
            border: 1px solid rgba(255,255,255,0.04);
            border-radius: 50%;
            transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .btn-inner {
            position: absolute;
            top: 35%; left: 35%;
            width: 30%; height: 30%;
            border: 1px solid rgba(255,255,255,0.02);
            border-radius: 50%;
            transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .btn-core {
            position: absolute;
            top: 50%; left: 50%;
            width: 6px; height: 6px;
            background: var(--silver);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 0 20px rgba(255,255,255,0.15);
        }

        .intro-btn:hover .btn-outer { border-color: var(--grey); transform: scale(1.06); }
        .intro-btn:hover .btn-middle { border-color: rgba(255,255,255,0.08); transform: scale(1.04); }
        .intro-btn:hover .btn-inner { border-color: rgba(255,255,255,0.06); transform: scale(1.02); }
        .intro-btn:hover .btn-core {
            background: var(--white);
            transform: translate(-50%, -50%) scale(1.8);
            box-shadow: 0 0 40px rgba(255,255,255,0.4), 0 0 80px rgba(255,255,255,0.2);
        }

        .intro-hint {
            position: absolute;
            bottom: 12%;
            font-size: 0.6rem;
            font-weight: 300;
            letter-spacing: 0.3em;
            color: var(--steel);
            opacity: 0;
        }

        /* === COUNTDOWN SCENE === */
        #countdown { background: var(--black); }

        .count-container { position: relative; }

        .count-num {
            font-family: 'Inter', sans-serif;
            font-size: clamp(10rem, 38vw, 30rem);
            font-weight: 100;
            line-height: 0.9;
            letter-spacing: -0.05em;
            color: var(--white);
            opacity: 0;
            text-shadow: 
                0 0 80px rgba(255,255,255,0.4),
                0 0 160px rgba(255,255,255,0.2);
        }

        .count-ring {
            position: absolute;
            top: 50%; left: 50%;
            width: 120%; height: 120%;
            border: 1px solid rgba(255,255,255,0.03);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0;
        }

        /* === FINALE SCENE === */
        #finale { background: transparent; }

        .finale-content { text-align: center; }

        .finale-greeting {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.8rem, 7vw, 4.5rem);
            font-weight: 400;
            font-style: italic;
            letter-spacing: 0.02em;
            color: var(--white);
            opacity: 0;
            transform: translateY(25px);
            margin-bottom: 0.3em;
            text-shadow: 0 0 60px rgba(255,255,255,0.3);
        }

        .finale-year {
            font-family: 'Inter', sans-serif;
            font-size: clamp(4rem, 18vw, 14rem);
            font-weight: 100;
            letter-spacing: 0.15em;
            color: var(--white);
            opacity: 0;
            transform: translateY(20px);
            line-height: 1;
            text-shadow: 
                0 0 100px rgba(255,255,255,0.3),
                0 0 200px rgba(255,255,255,0.1);
        }

        .finale-divider {
            width: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--grey), transparent);
            margin: 2rem auto;
            opacity: 0;
        }

        .finale-msg {
            font-size: clamp(0.65rem, 1.4vw, 0.8rem);
            font-weight: 300;
            letter-spacing: 0.35em;
            text-transform: uppercase;
            color: var(--mist);
            opacity: 0;
            transform: translateY(10px);
        }

        /* === CONTROLS === */
        .controls {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            display: flex;
            gap: 2.5rem;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .controls.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        .ctrl {
            background: none;
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 0.6rem;
            font-weight: 300;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            color: var(--steel);
            cursor: pointer;
            padding: 0.75rem 0;
            position: relative;
            transition: color 0.4s ease;
        }
        .ctrl::after {
            content: '';
            position: absolute;
            bottom: 0; left: 50%;
            width: 0; height: 1px;
            background: var(--silver);
            transform: translateX(-50%);
            transition: width 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .ctrl:hover { color: var(--cloud); }
        .ctrl:hover::after { width: 100%; }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .intro-btn { width: 120px; height: 120px; }
            .intro-text { font-size: 0.7rem; margin-bottom: 2.5rem; }
            .intro-hint { font-size: 0.55rem; bottom: 10%; }
            .controls { bottom: 1.5rem; gap: 2rem; }
            .ctrl { font-size: 0.65rem; padding: 1rem 0.5rem; }
            .count-num { font-size: clamp(8rem, 35vw, 20rem); }
            .finale-greeting { font-size: clamp(1.5rem, 6vw, 3rem); }
            .finale-year { font-size: clamp(3rem, 16vw, 10rem); }
            .finale-msg { font-size: 0.6rem; letter-spacing: 0.25em; }
            .glow-orb { display: none; }
        }

        @media (max-width: 480px) {
            .intro-btn { width: 100px; height: 100px; }
            .intro-text { font-size: 0.6rem; letter-spacing: 0.3em; margin-bottom: 2rem; }
            .controls { gap: 1.5rem; bottom: 1.2rem; }
            .ctrl { font-size: 0.6rem; }
            .finale-divider { margin: 1.5rem auto; }
        }

        @media (max-height: 600px) {
            .intro-text { margin-bottom: 1.5rem; }
            .intro-btn { width: 90px; height: 90px; }
            .intro-hint { bottom: 8%; }
            .finale-divider { margin: 1rem auto; }
        }

        /* Safe area for notched phones */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .controls { bottom: calc(1.5rem + env(safe-area-inset-bottom)); }
            .intro-hint { bottom: calc(10% + env(safe-area-inset-bottom)); }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
            .grain { display: none; }
        }
    </style>
</head>
<body>
    <!-- Visual Layers -->
    <canvas id="sky" class="layer"></canvas>
    <canvas id="aurora" class="layer"></canvas>
    <canvas id="stars" class="layer"></canvas>
    <canvas id="shootingStars" class="layer"></canvas>
    <canvas id="fireworks" class="layer"></canvas>

    <!-- Overlays -->
    <div class="grain"></div>
    <div class="vignette"></div>
    <div class="glow-orb glow-1"></div>
    <div class="glow-orb glow-2"></div>
    <div class="glow-orb glow-3"></div>

    <!-- UI -->
    <div class="ui-layer">
        <!-- Intro -->
        <section id="intro" class="scene active">
            <p class="intro-text">Begin when ready</p>
            <button class="intro-btn" id="startBtn" aria-label="Start Experience">
                <div class="btn-outer"></div>
                <div class="btn-middle"></div>
                <div class="btn-inner"></div>
                <div class="btn-core"></div>
            </button>
            <p class="intro-hint">tap to start</p>
        </section>

        <!-- Countdown -->
        <section id="countdown" class="scene">
            <div class="count-container">
                <div class="count-ring"></div>
                <div class="count-num" id="countNum">10</div>
            </div>
        </section>

        <!-- Finale -->
        <section id="finale" class="scene">
            <div class="finale-content">
                <p class="finale-greeting">Happy New Year</p>
                <h1 class="finale-year">2026</h1>
                <div class="finale-divider"></div>
                <p class="finale-msg">A new chapter begins</p>
            </div>
        </section>
    </div>

    <!-- Controls -->
    <nav class="controls" id="controls">
        <button class="ctrl" id="replayBtn">Replay</button>
        <button class="ctrl" id="soundBtn">Sound On</button>
    </nav>

    <script>
    (() => {
        'use strict';

        const Sound = {
            ctx: null,
            master: null,
            muted: false,
            pads: [],

            init() {
                if (this.ctx) return;
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.master = this.ctx.createGain();
                this.master.gain.value = 0.4;
                this.master.connect(this.ctx.destination);
            },

            tick() {
                if (!this.ctx || this.muted) return;
                const t = this.ctx.currentTime;

                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(75, t);
                osc.frequency.exponentialRampToValueAtTime(30, t + 0.5);
                g.gain.setValueAtTime(0, t);
                g.gain.linearRampToValueAtTime(0.4, t + 0.015);
                g.gain.exponentialRampToValueAtTime(0.001, t + 0.9);
                osc.connect(g);
                g.connect(this.master);
                osc.start(t);
                osc.stop(t + 1);

                const click = this.ctx.createOscillator();
                const cg = this.ctx.createGain();
                click.type = 'triangle';
                click.frequency.value = 2000;
                cg.gain.setValueAtTime(0.08, t);
                cg.gain.exponentialRampToValueAtTime(0.001, t + 0.03);
                click.connect(cg);
                cg.connect(this.master);
                click.start(t);
                click.stop(t + 0.05);
            },

            boom(intensity = 1) {
                if (!this.ctx || this.muted) return;
                const t = this.ctx.currentTime;

                const len = this.ctx.sampleRate * 3;
                const buf = this.ctx.createBuffer(1, len, this.ctx.sampleRate);
                const data = buf.getChannelData(0);
                for (let i = 0; i < len; i++) {
                    data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / len, 1.8);
                }
                const src = this.ctx.createBufferSource();
                src.buffer = buf;

                const flt = this.ctx.createBiquadFilter();
                flt.type = 'lowpass';
                flt.frequency.setValueAtTime(500 * intensity, t);
                flt.frequency.exponentialRampToValueAtTime(60, t + 2);

                const g = this.ctx.createGain();
                g.gain.setValueAtTime(0.25 * intensity, t);
                g.gain.exponentialRampToValueAtTime(0.001, t + 2.5);

                src.connect(flt);
                flt.connect(g);
                g.connect(this.master);
                src.start(t);

                const sub = this.ctx.createOscillator();
                const sg = this.ctx.createGain();
                sub.frequency.setValueAtTime(50, t);
                sub.frequency.exponentialRampToValueAtTime(25, t + 0.4);
                sg.gain.setValueAtTime(0.35 * intensity, t);
                sg.gain.exponentialRampToValueAtTime(0.001, t + 0.5);
                sub.connect(sg);
                sg.connect(this.master);
                sub.start(t);
                sub.stop(t + 0.6);
            },

            startPad() {
                if (!this.ctx) return;
                const freqs = [65.41, 98.00, 130.81, 196.00, 261.63];
                freqs.forEach((f, i) => {
                    const o = this.ctx.createOscillator();
                    const g = this.ctx.createGain();
                    o.type = 'sine';
                    o.frequency.value = f;
                    o.detune.value = Math.random() * 6 - 3;
                    g.gain.value = 0;
                    g.gain.linearRampToValueAtTime(0.018, this.ctx.currentTime + 2 + i * 0.4);
                    o.connect(g);
                    g.connect(this.master);
                    o.start();
                    this.pads.push({ o, g });
                });
            },

            stopPad() {
                if (!this.ctx) return;
                const t = this.ctx.currentTime;
                this.pads.forEach(p => {
                    p.g.gain.setValueAtTime(p.g.gain.value, t);
                    p.g.gain.exponentialRampToValueAtTime(0.0001, t + 2);
                    p.o.stop(t + 2.1);
                });
                this.pads = [];
            },

            toggle() {
                this.muted = !this.muted;
                if (this.master) {
                    this.master.gain.setTargetAtTime(this.muted ? 0 : 0.4, this.ctx.currentTime, 0.1);
                }
                return this.muted;
            }
        };

        const canvases = {};
        const contexts = {};
        ['sky', 'aurora', 'stars', 'shootingStars', 'fireworks'].forEach(id => {
            canvases[id] = document.getElementById(id);
            contexts[id] = canvases[id].getContext('2d');
        });

        let W, H;
        function resize() {
            W = window.innerWidth;
            H = window.innerHeight;
            Object.values(canvases).forEach(c => { c.width = W; c.height = H; });
        }
        window.addEventListener('resize', resize);
        resize();

        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

        let stars = [];
        function initStars() {
            stars = [];
            const count = Math.floor((W * H) / (isMobile ? 8000 : 4000));
            for (let i = 0; i < count; i++) {
                stars.push({
                    x: Math.random() * W,
                    y: Math.random() * H,
                    r: Math.random() * 1.2 + 0.2,
                    a: Math.random() * 0.6 + 0.15,
                    p: Math.random() * Math.PI * 2,
                    s: Math.random() * 0.01 + 0.003
                });
            }
        }

        function drawStars() {
            const ctx = contexts.stars;
            ctx.clearRect(0, 0, W, H);
            stars.forEach(st => {
                st.p += st.s;
                const twinkle = 0.6 + 0.4 * Math.sin(st.p);
                ctx.beginPath();
                ctx.arc(st.x, st.y, st.r, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(255,255,255,${st.a * twinkle})`;
                ctx.fill();
            });
        }

        let shooters = [];
        function spawnShooter() {
            if (Math.random() > (isMobile ? 0.002 : 0.003)) return;
            shooters.push({
                x: Math.random() * W * 0.8,
                y: Math.random() * H * 0.4,
                len: 80 + Math.random() * 120,
                speed: 12 + Math.random() * 8,
                angle: Math.PI / 4 + Math.random() * 0.3,
                life: 1
            });
        }

        function drawShooters() {
            const ctx = contexts.shootingStars;
            ctx.clearRect(0, 0, W, H);
            shooters = shooters.filter(s => {
                s.x += Math.cos(s.angle) * s.speed;
                s.y += Math.sin(s.angle) * s.speed;
                s.life -= 0.015;
                if (s.life <= 0) return false;

                const grad = ctx.createLinearGradient(
                    s.x, s.y,
                    s.x - Math.cos(s.angle) * s.len,
                    s.y - Math.sin(s.angle) * s.len
                );
                grad.addColorStop(0, `rgba(255,255,255,${s.life * 0.9})`);
                grad.addColorStop(1, 'transparent');

                ctx.beginPath();
                ctx.moveTo(s.x, s.y);
                ctx.lineTo(
                    s.x - Math.cos(s.angle) * s.len * s.life,
                    s.y - Math.sin(s.angle) * s.len * s.life
                );
                ctx.strokeStyle = grad;
                ctx.lineWidth = 1.5;
                ctx.stroke();
                return true;
            });
        }

        let auroraTime = 0;
        function drawAurora() {
            const ctx = contexts.aurora;
            ctx.clearRect(0, 0, W, H);
            auroraTime += 0.003;

            const grad = ctx.createLinearGradient(0, 0, 0, H * 0.6);
            grad.addColorStop(0, 'transparent');
            grad.addColorStop(0.3, `rgba(40, 80, 120, ${0.08 + Math.sin(auroraTime) * 0.03})`);
            grad.addColorStop(0.6, `rgba(60, 100, 80, ${0.05 + Math.sin(auroraTime * 1.3) * 0.02})`);
            grad.addColorStop(1, 'transparent');

            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, W, H * 0.6);
        }

        let particles = [], rockets = [], celebrating = false;

        class Rocket {
            constructor() {
                this.x = W * (0.15 + Math.random() * 0.7);
                this.y = H;
                this.ty = H * (0.1 + Math.random() * 0.35);
                this.vy = -14 - Math.random() * 4;
                this.trail = [];
            }
            update() {
                this.trail.push({ x: this.x, y: this.y, a: 0.6 });
                if (this.trail.length > 12) this.trail.shift();
                this.y += this.vy;
                this.vy *= 0.975;
                return this.y > this.ty && this.vy < -2;
            }
            draw(ctx) {
                this.trail.forEach((t, i) => {
                    t.a *= 0.88;
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, 1.2, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255,250,240,${t.a})`;
                    ctx.fill();
                });
            }
            explode() {
                const palettes = [
                    ['#fffaf0', '#ffd700', '#ffb347', '#ff8c00'],
                    ['#f0f0ff', '#c8c8ff', '#9090ee', '#6060cc'],
                    ['#fff0f0', '#ffc8c8', '#ff9090', '#ee6060'],
                    ['#f0fff8', '#c8ffd8', '#90eebb', '#60cc99'],
                    ['#ffffff', '#f8f8f8', '#e8e8e8', '#d0d0d0']
                ];
                const palette = palettes[Math.floor(Math.random() * palettes.length)];
                const count = isMobile ? (60 + Math.floor(Math.random() * 30)) : (100 + Math.floor(Math.random() * 50));

                for (let i = 0; i < count; i++) {
                    const angle = (Math.PI * 2 / count) * i + Math.random() * 0.2;
                    const speed = 1 + Math.random() * 5;
                    particles.push({
                        x: this.x, y: this.y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        color: palette[Math.floor(Math.random() * palette.length)],
                        life: 1,
                        decay: 0.007 + Math.random() * 0.01,
                        size: 1.5 + Math.random() * 1.5
                    });
                }
                Sound.boom(0.5 + Math.random() * 0.5);
            }
        }

        function drawFireworks() {
            const ctx = contexts.fireworks;
            ctx.fillStyle = 'rgba(0,0,0,0.12)';
            ctx.fillRect(0, 0, W, H);

            if (celebrating && Math.random() < (isMobile ? 0.015 : 0.02)) {
                rockets.push(new Rocket());
            }

            rockets = rockets.filter(r => {
                r.draw(ctx);
                if (!r.update()) { r.explode(); return false; }
                return true;
            });

            particles = particles.filter(p => {
                p.vx *= 0.985;
                p.vy *= 0.985;
                p.vy += 0.02;
                p.x += p.vx;
                p.y += p.vy;
                p.life -= p.decay;
                if (p.life <= 0) return false;

                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life * 0.85;
                ctx.fill();
                ctx.globalAlpha = 1;
                return true;
            });
        }

        function animate() {
            drawStars();
            drawShooters();
            spawnShooter();
            drawAurora();
            drawFireworks();
            requestAnimationFrame(animate);
        }

        const scenes = {
            intro: document.getElementById('intro'),
            countdown: document.getElementById('countdown'),
            finale: document.getElementById('finale')
        };
        const countNum = document.getElementById('countNum');
        const controls = document.getElementById('controls');
        let isRunning = false;

        function showScene(name) {
            Object.entries(scenes).forEach(([k, el]) => {
                el.classList.toggle('active', k === name);
            });
        }

        function runCountdown() {
            let n = 10;
            const tick = () => {
                if (n > 0) {
                    countNum.textContent = n;
                    Sound.tick();

                    gsap.fromTo(countNum,
                        { opacity: 0, scale: 0.9 },
                        { opacity: 1, scale: 1, duration: 0.4, ease: 'power2.out',
                          onComplete: () => gsap.to(countNum, { opacity: 0, duration: 0.4, delay: 0.2 })
                        }
                    );
                    gsap.fromTo('.count-ring',
                        { scale: 0.8, opacity: 0.15 },
                        { scale: 1.8, opacity: 0, duration: 0.9, ease: 'power1.out' }
                    );

                    n--;
                    setTimeout(tick, 1000);
                } else {
                    gsap.to(scenes.countdown, { opacity: 0, duration: 0.25 });
                    setTimeout(triggerFinale, 350);
                }
            };
            setTimeout(tick, 700);
        }

        function triggerFinale() {
            showScene('finale');
            celebrating = true;
            canvases.fireworks.style.opacity = 1;

            for (let i = 0; i < 3; i++) setTimeout(() => rockets.push(new Rocket()), i * 250);

            const tl = gsap.timeline();
            tl.to('.finale-greeting', { opacity: 1, y: 0, duration: 2, delay: 1.2, ease: 'power3.out' })
              .to('.finale-year', { opacity: 1, y: 0, duration: 2.2, ease: 'power3.out' }, '-=1.5')
              .to('.finale-divider', { opacity: 1, width: 80, duration: 1.2, ease: 'power2.out' }, '-=1.2')
              .to('.finale-msg', { opacity: 1, y: 0, duration: 1.8, ease: 'power3.out' }, '-=0.6')
              .add(() => controls.classList.add('show'), '+=0.5');
        }

        function reset() {
            celebrating = false;
            particles = [];
            rockets = [];
            contexts.fireworks.clearRect(0, 0, W, H);
            canvases.fireworks.style.opacity = 0;
            controls.classList.remove('show');
            document.body.classList.remove('immersive');

            gsap.set(scenes.countdown, { opacity: 1 });
            gsap.set(countNum, { opacity: 0 });
            gsap.set('.count-ring', { opacity: 0 });
            gsap.set(['.finale-greeting', '.finale-year', '.finale-msg'], { opacity: 0, y: 20 });
            gsap.set('.finale-divider', { opacity: 0, width: 0 });

            Sound.stopPad();
            isRunning = false;
            showScene('intro');

            setTimeout(() => {
                gsap.to('.intro-text', { opacity: 1, y: 0, duration: 1.2 });
                gsap.to('.intro-btn', { opacity: 1, scale: 1, duration: 1.2, delay: 0.2 });
            }, 800);
        }

        function init() {
            initStars();
            animate();

            gsap.to('.intro-text', { opacity: 1, y: 0, duration: 1.8, delay: 0.8, ease: 'power2.out' });
            gsap.to('.intro-btn', { opacity: 1, scale: 1, duration: 1.8, delay: 1.2, ease: 'power2.out' });
            gsap.to('.intro-hint', { opacity: 1, duration: 1.2, delay: 3 });
            gsap.to('.glow-orb', { opacity: 1, duration: 3, delay: 0.5 });
            gsap.to(canvases.aurora, { opacity: 0.6, duration: 4, delay: 1 });

            document.getElementById('startBtn').addEventListener('click', () => {
                if (isRunning) return;
                isRunning = true;
                
                Sound.init();
                Sound.startPad();
                document.body.classList.add('immersive');

                gsap.to(['.intro-text', '.intro-btn', '.intro-hint'], {
                    opacity: 0, duration: 0.5, stagger: 0.08,
                    onComplete: () => {
                        showScene('countdown');
                        setTimeout(runCountdown, 600);
                    }
                });
            });

            document.getElementById('replayBtn').addEventListener('click', reset);
            document.getElementById('soundBtn').addEventListener('click', () => {
                const muted = Sound.toggle();
                document.getElementById('soundBtn').textContent = muted ? 'Sound Off' : 'Sound On';
            });
        }

        init();
    })();
    </script>
</body>
</html>